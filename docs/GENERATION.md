# xplat Generation Guide

**How files get generated and when to use each command.**

## Two Sources of Generation

xplat generates files from **two different sources**:

| Source | Command | What it generates |
|--------|---------|-------------------|
| **YOUR manifest** (`xplat.yaml`) | `xplat manifest bootstrap` | Project files for YOUR repo |
| **Installed packages** (`xplat-lock.yaml`) | `xplat gen process/taskfile` | Aggregated config from REMOTE packages |

## Quick Reference

```
# New project or changed xplat.yaml? Use bootstrap:
xplat manifest bootstrap --force

# Installed new packages? Use gen:
xplat gen taskfile    # Taskfile.generated.yml (remote includes)
xplat gen process     # pc.generated.yaml (aggregated processes)
```

## Generation Flow Diagram

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         YOUR PROJECT                                     │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  xplat.yaml (YOUR manifest)                                              │
│       │                                                                  │
│       ├──► xplat manifest bootstrap [--force]                            │
│       │         │                                                        │
│       │         ├──► Taskfile.yml           (build/run tasks)            │
│       │         ├──► process-compose.yaml   (from processes: section)    │
│       │         ├──► .gitignore                                          │
│       │         ├──► .github/workflows/ci.yml                            │
│       │         ├──► .env.example           (from env: section)          │
│       │         ├──► README.md              (if missing)                 │
│       │         └──► taskfiles/Taskfile.service.yml (for consumers)      │
│       │                                                                  │
│       └──► xplat manifest show              (view manifest)              │
│                                                                          │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  xplat-lock.yaml (INSTALLED PACKAGES)                                    │
│       │                                                                  │
│       ├──► xplat gen taskfile                                            │
│       │         └──► Taskfile.generated.yml (remote includes)            │
│       │                                                                  │
│       └──► xplat gen process                                             │
│                 └──► pc.generated.yaml      (aggregated processes)       │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

## Common Workflows

### 1. New Project Setup

```bash
# Create xplat.yaml (or let init create one)
xplat manifest init

# Generate all standard files
xplat manifest bootstrap
```

### 2. Changed Your Manifest

After editing `xplat.yaml` (added process, changed binary, etc.):

```bash
xplat manifest bootstrap --force
```

### 3. Installed Packages from Registry

After `xplat pkg install plat-nats`:

```bash
xplat gen taskfile    # Include nats tasks
xplat gen process     # Include nats process
```

### 4. View What's Configured

```bash
xplat manifest show   # See YOUR manifest
xplat pkg list        # See installed packages
```

## File Purposes

| File | Purpose | Generated by |
|------|---------|--------------|
| `xplat.yaml` | YOUR project manifest (source of truth) | `xplat manifest init` or manual |
| `Taskfile.yml` | Build/run tasks for YOUR project | `manifest bootstrap` |
| `process-compose.yaml` | Services for YOUR project | `manifest bootstrap` |
| `taskfiles/Taskfile.service.yml` | Reusable tasks for CONSUMERS of your package | `manifest bootstrap` |
| `Taskfile.generated.yml` | Remote includes from INSTALLED packages | `xplat gen taskfile` |
| `pc.generated.yaml` | Processes from INSTALLED packages | `xplat gen process` |
| `xplat-lock.yaml` | Lock file for installed packages | `xplat pkg install` |

## The Key Distinction

**`manifest bootstrap`** = Generate from **YOUR** `xplat.yaml`
- Use when: setting up project, changed your manifest

**`xplat gen`** = Generate from **INSTALLED PACKAGES** in `xplat-lock.yaml`
- Use when: installed/removed packages, want to aggregate remote configs

## Example: plat-splat

```yaml
# xplat.yaml
name: plat-splat
processes:
  polyform:
    command: task polyform:run
    port: 8080
```

Running `xplat manifest bootstrap` generates:

```yaml
# process-compose.yaml (GENERATED)
processes:
  polyform:
    command: xplat task polyform:run
    readiness_probe:
      exec:
        command: xplat task polyform:health
```

The command is auto-prefixed with `xplat` and health check is auto-generated.
