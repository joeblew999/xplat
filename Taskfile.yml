version: '3'

# =============================================================================
# xplat - Cross-Platform Taskfile Bootstrapper
# =============================================================================
# Auto-generated from xplat commands. Do not edit directly.
# Regenerate with: xplat docs taskfile
# =============================================================================

vars:
  BIN_INSTALL_DIR: '{{if eq OS "windows"}}{{.HOME}}/bin{{else}}{{.HOME}}/.local/bin{{end}}'
  XPLAT_BIN: '{{.BIN_INSTALL_DIR}}/xplat{{exeExt}}'
  # Local build binary (for development)
  XPLAT_LOCAL: './xplat{{exeExt}}'

tasks:
  default:
    desc: Show available tasks
    cmds:
      - task --list

  # ===========================================================================
  # Service Commands (front and center!)
  # ===========================================================================
  # Start xplat as a system service with all features enabled:
  #   - Process orchestration (process-compose)
  #   - Task UI web dashboard
  #   - MCP HTTP server for AI IDE integration

  up:
    desc: "Start xplat service with UI + MCP (recommended)"
    cmds:
      - "{{.XPLAT_LOCAL}} service start --with-ui --with-mcp"

  up:ui:
    desc: "Start xplat service with UI only"
    cmds:
      - "{{.XPLAT_LOCAL}} service start --with-ui"

  up:mcp:
    desc: "Start xplat service with MCP only"
    cmds:
      - "{{.XPLAT_LOCAL}} service start --with-mcp"

  up:minimal:
    desc: "Start xplat service (process-compose only)"
    cmds:
      - "{{.XPLAT_LOCAL}} service start"

  down:
    desc: "Stop xplat service"
    cmds:
      - "{{.XPLAT_LOCAL}} service stop"

  status:
    desc: "Show xplat service status"
    cmds:
      - "{{.XPLAT_LOCAL}} service status"

  restart:
    desc: "Restart xplat service"
    cmds:
      - "{{.XPLAT_LOCAL}} service restart"

  # ===========================================================================
  # Build and Test
  # ===========================================================================

  build:
    desc: Build xplat binary
    cmds:
      - go build -o xplat{{exeExt}} .

  build:install:
    desc: Build and install xplat to ~/.local/bin (ONLY location)
    cmds:
      - task: build:clean-stale
      - mkdir -p "{{.BIN_INSTALL_DIR}}"
      - go build -o "{{.XPLAT_BIN}}" .
      - echo "âœ“ Installed to {{.XPLAT_BIN}}"

  build:clean-stale:
    desc: Remove xplat from non-canonical locations
    cmds:
      - rm -f {{.HOME}}/go/bin/xplat 2>/dev/null || true
      - rm -f /usr/local/bin/xplat 2>/dev/null || true
      - rm -f /tmp/xplat* 2>/dev/null || true
    silent: true

  test:
    desc: Run tests
    cmds:
      - go test ./... -v

  clean:
    desc: Clean build artifacts
    cmds:
      - rm -f xplat xplat.exe
      - rm -rf .task/

  docs:
    desc: Regenerate README.md and Taskfile.yml from code (xplat devs only)
    cmds:
      - "{{.XPLAT_LOCAL}} internal:docs all"

  # ===========================================================================
  # xplat Command Wrappers
  # ===========================================================================

  xplat:binary:
    desc: "Binary management commands"
    cmds:
      - "{{.XPLAT_LOCAL}} binary {{.CLI_ARGS}}"

  xplat:gen:
    desc: "Generate project files from YOUR local xplat.yaml"
    cmds:
      - "{{.XPLAT_LOCAL}} gen {{.CLI_ARGS}}"

  xplat:internal:docs:
    desc: "Generate xplat's own documentation (for xplat developers)"
    cmds:
      - "{{.XPLAT_LOCAL}} internal:docs {{.CLI_ARGS}}"

  xplat:manifest:
    desc: "Inspect, validate, and bootstrap xplat.yaml manifests"
    cmds:
      - "{{.XPLAT_LOCAL}} manifest {{.CLI_ARGS}}"

  xplat:mcp:
    desc: "MCP (Model Context Protocol) server"
    cmds:
      - "{{.XPLAT_LOCAL}} mcp {{.CLI_ARGS}}"

  xplat:os:
    desc: "Cross-platform OS utilities"
    cmds:
      - "{{.XPLAT_LOCAL}} os {{.CLI_ARGS}}"

  xplat:pkg:
    desc: "Install packages from REMOTE registry (binaries, taskfiles, processes)"
    cmds:
      - "{{.XPLAT_LOCAL}} pkg {{.CLI_ARGS}}"

  xplat:process:
    desc: "Process orchestration (embedded process-compose)"
    cmds:
      - "{{.XPLAT_LOCAL}} process {{.CLI_ARGS}}"

  xplat:release:
    desc: "Release build orchestration"
    cmds:
      - "{{.XPLAT_LOCAL}} release {{.CLI_ARGS}}"

  xplat:run:
    desc: "Run a managed tool"
    cmds:
      - "{{.XPLAT_LOCAL}} run {{.CLI_ARGS}}"

  xplat:service:
    desc: "Manage xplat as a system service"
    cmds:
      - "{{.XPLAT_LOCAL}} service {{.CLI_ARGS}}"

  xplat:sync-cf:
    desc: "Cloudflare sync operations (no wrangler CLI required)"
    cmds:
      - "{{.XPLAT_LOCAL}} sync-cf {{.CLI_ARGS}}"

  xplat:sync-gh:
    desc: "GitHub sync operations (no gh CLI required)"
    cmds:
      - "{{.XPLAT_LOCAL}} sync-gh {{.CLI_ARGS}}"

  xplat:task:
    desc: "Run Taskfile tasks (embedded Task runner)"
    cmds:
      - "{{.XPLAT_LOCAL}} task {{.CLI_ARGS}}"

  xplat:ui:
    desc: "Start Task UI web interface"
    cmds:
      - "{{.XPLAT_LOCAL}} ui {{.CLI_ARGS}}"

  xplat:update:
    desc: "Update xplat to the latest version"
    cmds:
      - "{{.XPLAT_LOCAL}} update {{.CLI_ARGS}}"

  xplat:version:
    desc: "Print xplat version"
    cmds:
      - "{{.XPLAT_LOCAL}} version {{.CLI_ARGS}}"

