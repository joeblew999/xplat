# Environment Management Tasks
#
# Environment validation and management via cmd/env.
# WARNING: cmd/env is currently broken - see TODO.md
#
# Usage:
#   task env:validate      - Fast format checks
#   task env:validate:deep - API validation
#   task env:admin         - GUI for environment setup

version: '3'

tasks:
  # ===========================================================================
  # Validation
  # ===========================================================================

  validate:
    desc: "Validate .env file (fast format checks)"
    cmds:
      - go run {{.ENV_CMD}} validate

  validate:deep:
    desc: "Validate .env file with API checks"
    cmds:
      - go run {{.ENV_CMD}} validate-deep

  # ===========================================================================
  # Admin GUI
  # ===========================================================================

  admin:
    desc: "Open admin GUI for environment setup (starts Caddy + Via GUI)"
    cmds:
      - go run {{.ENV_CMD}} admin

  admin:mock:
    desc: "Open admin GUI with mock validation (for testing)"
    cmds:
      - go run {{.ENV_CMD}} admin-mock

  # ===========================================================================
  # Build & Deploy (via env manager)
  # ===========================================================================

  build:
    desc: "Build site via env manager (starts preview server with Caddy)"
    cmds:
      - go run {{.ENV_CMD}} build

  deploy:preview:
    desc: "Build + deploy to Cloudflare Pages preview"
    cmds:
      - go run {{.ENV_CMD}} deploy-preview

  deploy:production:
    desc: "Build + deploy to Cloudflare Pages production"
    cmds:
      - go run {{.ENV_CMD}} deploy-production

  domain-status:
    desc: "Check custom domain status for Cloudflare Pages"
    cmds:
      - go run {{.ENV_CMD}} domain-status

  # ===========================================================================
  # Caddy (local HTTPS proxy)
  # ===========================================================================

  caddy:start:
    desc: "Start local Caddy HTTPS proxy"
    cmds:
      - go run {{.ENV_CMD}} caddy-start

  caddy:stop:
    desc: "Stop local Caddy HTTPS proxy"
    cmds:
      - go run {{.ENV_CMD}} caddy-stop

  caddy:status:
    desc: "Show local Caddy status"
    cmds:
      - go run {{.ENV_CMD}} caddy-status

  # ===========================================================================
  # Process Management
  # ===========================================================================

  kill-all:
    desc: "Stop Caddy, Hugo, and Via processes started by env manager"
    cmds:
      - go run {{.ENV_CMD}} kill-all
